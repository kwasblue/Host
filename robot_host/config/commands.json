{
  "commands": {
    "CMD_HEARTBEAT": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Host heartbeat to maintain connection. Resets host timeout watchdog.",
      "payload": {}
    },
    "CMD_ARM": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Transition from IDLE to ARMED. Motors enabled but not accepting motion.",
      "payload": {}
    },
    "CMD_DISARM": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Transition from ARMED to IDLE. Motors disabled.",
      "payload": {}
    },
    "CMD_ACTIVATE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Transition from ARMED to ACTIVE. Motion commands now accepted.",
      "payload": {}
    },
    "CMD_DEACTIVATE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Transition from ACTIVE to ARMED. Stops motion, still armed.",
      "payload": {}
    },
    "CMD_ESTOP": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Emergency stop, immediately disable motion.",
      "payload": {}
    },
    "CMD_CLEAR_ESTOP": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Clear ESTOP and return to IDLE mode.",
      "payload": {}
    },
    "CMD_STOP": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Stop all motion (soft stop).",
      "payload": {}
    },
    "CMD_GET_RATES": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Get current loop rates (ctrl, safety, telem) in Hz.",
      "payload": {}
    },
    "CMD_CTRL_SET_RATE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set control loop rate in Hz. Only allowed when IDLE.",
      "payload": {
        "hz": {
          "type": "int",
          "required": true,
          "min": 5,
          "max": 200,
          "description": "Control loop frequency in Hz."
        }
      }
    },
    "CMD_SAFETY_SET_RATE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set safety loop rate in Hz. Only allowed when IDLE.",
      "payload": {
        "hz": {
          "type": "int",
          "required": true,
          "min": 20,
          "max": 500,
          "description": "Safety loop frequency in Hz."
        }
      }
    },
    "CMD_TELEM_SET_RATE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set telemetry loop rate in Hz. Only allowed when IDLE.",
      "payload": {
        "hz": {
          "type": "int",
          "required": true,
          "min": 1,
          "max": 50,
          "description": "Telemetry loop frequency in Hz."
        }
      }
    },
    "CMD_CTRL_SLOT_CONFIG": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Configure a control slot with controller type and signal routing. Only allowed when IDLE.",
      "payload": {
        "slot": {
          "type": "int",
          "required": true,
          "min": 0,
          "max": 7,
          "description": "Slot index (0-7)."
        },
        "type": {
          "type": "string",
          "required": true,
          "enum": [
            "PID",
            "SS"
          ],
          "description": "Controller type: PID or StateSpace."
        },
        "rate_hz": {
          "type": "int",
          "required": false,
          "default": 100,
          "min": 1,
          "max": 1000,
          "description": "Controller update rate in Hz."
        },
        "ref_id": {
          "type": "int",
          "required": true,
          "description": "Signal ID for reference/setpoint."
        },
        "meas_id": {
          "type": "int",
          "required": true,
          "description": "Signal ID for measurement/feedback."
        },
        "out_id": {
          "type": "int",
          "required": true,
          "description": "Signal ID for control output."
        },
        "require_armed": {
          "type": "bool",
          "required": false,
          "default": true,
          "description": "Only run when robot is armed."
        },
        "require_active": {
          "type": "bool",
          "required": false,
          "default": true,
          "description": "Only run when robot is active."
        }
      }
    },
    "CMD_CTRL_SLOT_ENABLE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Enable or disable a configured control slot.",
      "payload": {
        "slot": {
          "type": "int",
          "required": true,
          "min": 0,
          "max": 7,
          "description": "Slot index (0-7)."
        },
        "enable": {
          "type": "bool",
          "required": true,
          "description": "True to enable, False to disable."
        }
      }
    },
    "CMD_CTRL_SLOT_RESET": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Reset a control slot's internal state (integrators, etc).",
      "payload": {
        "slot": {
          "type": "int",
          "required": true,
          "min": 0,
          "max": 7,
          "description": "Slot index (0-7)."
        }
      }
    },
    "CMD_CTRL_SLOT_SET_PARAM": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set a parameter on a control slot's controller.",
      "payload": {
        "slot": {
          "type": "int",
          "required": true,
          "min": 0,
          "max": 7,
          "description": "Slot index (0-7)."
        },
        "key": {
          "type": "string",
          "required": true,
          "description": "Parameter name (e.g., 'kp', 'ki', 'kd', 'out_min', 'out_max')."
        },
        "value": {
          "type": "float",
          "required": true,
          "description": "Parameter value."
        }
      }
    },
    "CMD_CTRL_SLOT_STATUS": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Get status of a control slot.",
      "payload": {
        "slot": {
          "type": "int",
          "required": true,
          "min": 0,
          "max": 7,
          "description": "Slot index (0-7)."
        }
      }
    },
    "CMD_CTRL_SIGNAL_DEFINE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Define a new signal in the signal bus. Only allowed when IDLE.",
      "payload": {
        "id": {
          "type": "int",
          "required": true,
          "description": "Unique signal ID."
        },
        "name": {
          "type": "string",
          "required": true,
          "description": "Human-readable signal name."
        },
        "kind": {
          "type": "string",
          "required": true,
          "enum": [
            "REF",
            "MEAS",
            "OUT"
          ],
          "description": "Signal kind: REF (setpoint), MEAS (measurement), OUT (output)."
        },
        "initial": {
          "type": "float",
          "required": false,
          "default": 0.0,
          "description": "Initial value."
        }
      }
    },
    "CMD_CTRL_SIGNAL_SET": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set a signal value in the signal bus.",
      "payload": {
        "id": {
          "type": "int",
          "required": true,
          "description": "Signal ID."
        },
        "value": {
          "type": "float",
          "required": true,
          "description": "Value to set."
        }
      }
    },
    "CMD_CTRL_SIGNAL_GET": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Get a signal value from the signal bus.",
      "payload": {
        "id": {
          "type": "int",
          "required": true,
          "description": "Signal ID."
        }
      }
    },
    "CMD_CTRL_SIGNALS_LIST": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "List all defined signals in the signal bus.",
      "payload": {}
    },
    "CMD_SET_MODE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set the high-level robot mode. Prefer ARM/ACTIVATE/DISARM/DEACTIVATE.",
      "payload": {
        "mode": {
          "type": "string",
          "required": true,
          "enum": [
            "IDLE",
            "ARMED",
            "ACTIVE",
            "CALIB"
          ]
        }
      }
    },
    "CMD_SET_VEL": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set linear and angular velocity in robot frame.",
      "payload": {
        "vx": {
          "type": "float",
          "required": true,
          "units": "m/s"
        },
        "omega": {
          "type": "float",
          "required": true,
          "units": "rad/s"
        },
        "frame": {
          "type": "string",
          "required": false,
          "default": "robot",
          "enum": [
            "robot",
            "world"
          ]
        }
      }
    },
    "CMD_LED_ON": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Turn status LED on.",
      "payload": {}
    },
    "CMD_LED_OFF": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Turn status LED off.",
      "payload": {}
    },
    "CMD_GPIO_WRITE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Write a digital value to a logical GPIO channel.",
      "payload": {
        "channel": {
          "type": "int",
          "required": true
        },
        "value": {
          "type": "int",
          "required": true
        }
      }
    },
    "CMD_GPIO_READ": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Read a digital value from a logical GPIO channel.",
      "payload": {
        "channel": {
          "type": "int",
          "required": true
        }
      }
    },
    "CMD_GPIO_TOGGLE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Toggle a logical GPIO channel.",
      "payload": {
        "channel": {
          "type": "int",
          "required": true
        }
      }
    },
    "CMD_GPIO_REGISTER_CHANNEL": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Register or re-map a logical GPIO channel to a physical pin.",
      "payload": {
        "channel": {
          "type": "int",
          "required": true
        },
        "pin": {
          "type": "int",
          "required": true
        },
        "mode": {
          "type": "string",
          "required": false,
          "default": "output",
          "enum": [
            "output",
            "input",
            "input_pullup"
          ]
        }
      }
    },
    "CMD_PWM_SET": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set PWM duty cycle for a logical channel.",
      "payload": {
        "channel": {
          "type": "int",
          "required": true
        },
        "duty": {
          "type": "float",
          "required": true
        },
        "freq_hz": {
          "type": "float",
          "required": false
        }
      }
    },
    "CMD_SERVO_ATTACH": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Attach a servo ID to a physical pin.",
      "payload": {
        "servo_id": {
          "type": "int",
          "required": true
        },
        "channel": {
          "type": "int",
          "required": true
        },
        "min_us": {
          "type": "int",
          "required": false,
          "default": 1000
        },
        "max_us": {
          "type": "int",
          "required": false,
          "default": 2000
        }
      }
    },
    "CMD_SERVO_DETACH": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Detach a servo ID.",
      "payload": {
        "servo_id": {
          "type": "int",
          "required": true
        }
      }
    },
    "CMD_SERVO_SET_ANGLE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set servo angle in degrees.",
      "payload": {
        "servo_id": {
          "type": "int",
          "required": true
        },
        "angle_deg": {
          "type": "float",
          "required": true
        },
        "duration_ms": {
          "type": "int",
          "required": false,
          "default": 0,
          "description": "Interpolation duration in milliseconds (0 = immediate)."
        }
      }
    },
    "CMD_STEPPER_MOVE_REL": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Move a stepper a relative number of steps.",
      "payload": {
        "motor_id": {
          "type": "int",
          "required": true
        },
        "steps": {
          "type": "int",
          "required": true
        },
        "speed_steps_s": {
          "type": "float",
          "required": false,
          "default": 1000.0
        }
      }
    },
    "CMD_STEPPER_STOP": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Immediately stop a stepper motor.",
      "payload": {
        "motor_id": {
          "type": "int",
          "required": true
        }
      }
    },
    "CMD_STEPPER_ENABLE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Enable or disable a stepper driver (via enable pin).",
      "payload": {
        "motor_id": {
          "type": "int",
          "required": true
        },
        "enable": {
          "type": "bool",
          "required": false,
          "default": true
        }
      }
    },
    "CMD_ULTRASONIC_ATTACH": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Attach/configure an ultrasonic sensor for the given logical sensor_id.",
      "payload": {
        "sensor_id": {
          "type": "int",
          "required": true,
          "default": 0
        }
      }
    },
    "CMD_ULTRASONIC_READ": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Trigger a single ultrasonic distance measurement.",
      "payload": {
        "sensor_id": {
          "type": "int",
          "required": true,
          "default": 0
        }
      }
    },
    "CMD_TELEM_SET_INTERVAL": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set telemetry publish interval in milliseconds (0 = disable).",
      "payload": {
        "interval_ms": {
          "type": "int",
          "required": true,
          "default": 100
        }
      }
    },
    "CMD_SET_LOG_LEVEL": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set MCU logging verbosity level.",
      "payload": {
        "level": {
          "type": "string",
          "required": true,
          "enum": [
            "debug",
            "info",
            "warn",
            "error",
            "off"
          ],
          "default": "info"
        }
      }
    },
    "CMD_ENCODER_ATTACH": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Attach/configure a quadrature encoder with runtime pins.",
      "payload": {
        "encoder_id": {
          "type": "int",
          "required": true,
          "default": 0
        },
        "pin_a": {
          "type": "int",
          "required": true,
          "default": 32
        },
        "pin_b": {
          "type": "int",
          "required": true,
          "default": 33
        }
      }
    },
    "CMD_ENCODER_READ": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Request current tick count for a given encoder.",
      "payload": {
        "encoder_id": {
          "type": "int",
          "required": true,
          "default": 0
        }
      }
    },
    "CMD_ENCODER_RESET": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Reset the tick count for a given encoder back to zero.",
      "payload": {
        "encoder_id": {
          "type": "int",
          "required": true,
          "default": 0
        }
      }
    },
    "CMD_DC_SET_SPEED": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set DC motor speed and direction for a given motor ID.",
      "payload": {
        "motor_id": {
          "type": "int",
          "required": true,
          "description": "Logical DC motor ID (0..3)."
        },
        "speed": {
          "type": "float",
          "required": true,
          "description": "Normalized speed in [-1.0, 1.0]; sign = direction.",
          "min": -1.0,
          "max": 1.0
        }
      }
    },
    "CMD_DC_STOP": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Stop a DC motor (set speed to zero).",
      "payload": {
        "motor_id": {
          "type": "int",
          "required": true,
          "description": "Logical DC motor ID (0..3)."
        }
      }
    },
    "CMD_DC_VEL_PID_ENABLE": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Enable or disable closed-loop velocity PID control for a DC motor.",
      "payload": {
        "motor_id": {
          "type": "int",
          "required": true,
          "description": "Logical DC motor ID (0..3)."
        },
        "enable": {
          "type": "bool",
          "required": true,
          "description": "True to enable velocity PID, False to disable."
        }
      }
    },
    "CMD_DC_SET_VEL_TARGET": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Set desired angular velocity target for a DC motor's PID controller.",
      "payload": {
        "motor_id": {
          "type": "int",
          "required": true,
          "description": "Logical DC motor ID (0..3)."
        },
        "omega": {
          "type": "float",
          "required": true,
          "description": "Target angular velocity in rad/s (sign indicates direction)."
        }
      }
    },
    "CMD_DC_SET_VEL_GAINS": {
      "kind": "cmd",
      "direction": "host->mcu",
      "description": "Configure PID gains for DC motor velocity control.",
      "payload": {
        "motor_id": {
          "type": "int",
          "required": true,
          "description": "Logical DC motor ID (0..3)."
        },
        "kp": {
          "type": "float",
          "required": true,
          "description": "Proportional gain for velocity PID."
        },
        "ki": {
          "type": "float",
          "required": true,
          "description": "Integral gain for velocity PID."
        },
        "kd": {
          "type": "float",
          "required": true,
          "description": "Derivative gain for velocity PID."
        }
      }
    }
  },
  "schema_version": 1
}